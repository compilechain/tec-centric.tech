---
import BlogLayout from "../layouts/BlogLayout.astro";
import { getCollection } from "astro:content";

// Load posts (skip drafts) and sort newest first
const posts = (await getCollection("posts", ({ data }) => !data.draft))
  .sort((a, b) => new Date(b.data.date) - new Date(a.data.date));
---
<BlogLayout title="Tec-Centric Blog — Insights & Updates" description="Futuristic, sleek and modern EV & tech insights.">
  {posts.length === 0 ? (
    <div>
      <h2 style="margin:0 0 8px">No posts yet</h2>
      <p class="muted">Your content collection is set up. Add files in <code>src/content/posts</code>.</p>
    </div>
  ) : (
    <ul style="list-style:none;padding:0;margin:0;display:grid;gap:16px">
      {posts.map(({ data, slug }) => (
        <li class="card">
          <a href={`/blog/${slug}/`}><h2 style="margin:0 0 6px">{data?.title ?? "Untitled post"}</h2></a>
          <div class="muted" style="font-size:14px">
            {new Date(data?.date ?? Date.now()).toLocaleDateString()} · {data?.readingTime ?? "5 min read"}
            {data?.tags?.length ? ` · ${data.tags.join(", ")}` : ""}
          </div>
          <p style="margin:8px 0 0">{data?.description ?? ""}</p>
        </li>
      ))}
    </ul>
  )}
</BlogLayout>
