---
import Layout from "../layouts/BlogLayout.astro";
import Matrix from "../components/MatrixCanvas.astro";
import Glow from "../components/CssGlow.astro";
import { getCollection } from "astro:content";

const title = "Tec-Centric Technologies Blog";
const description = "Futuristic, sleek insights on EV, data, and Malaysian tech.";

const posts = await getCollection('posts');
---

<Layout {title} {description}>

  <!-- Background effects (home page only) -->
  <script is:inline>
    (function(){
      const root = document.documentElement;
      const saved = localStorage.getItem('tcEffect') || 'off';
      const reduced = matchMedia('(prefers-reduced-motion: reduce)');

      function apply(v){
        if(reduced.matches) v='off';
        root.setAttribute('data-effect', v);
        localStorage.setItem('tcEffect', v);
        const sel = document.getElementById('tcEffectSel');
        if(sel) sel.value = v;
      }

      addEventListener('DOMContentLoaded',()=>apply(saved));
      reduced.addEventListener?.('change',()=>apply(localStorage.getItem('tcEffect')||'off'));
      addEventListener('change', e=>{
        if(e.target && e.target.id==='tcEffectSel') apply(e.target.value);
      });
    })();
  </script>

  <Matrix />
  <Glow />

  <!-- Tiny toggle UI -->
  <div style="display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-bottom:12px;color:var(--muted);font-size:14px">
    Effects:
    <select id="tcEffectSel" aria-label="Background effect">
      <option value="off">Off</option>
      <option value="glow">Glow</option>
      <option value="matrix">Matrix</option>
    </select>
  </div>

  <!-- Your existing homepage content: minimal post list -->
  <section aria-label="Latest posts" style="display:grid;gap:1rem">
    {posts.length === 0 ? (
      <p>No posts yet. Create one in <code>blog/src/content/posts/</code>.</p>
    ) : (
      posts.map(p => (
        <article>
          <h3><a href={`/blog/${p.slug}/`}>{p.data.title ?? p.slug}</a></h3>
          {p.data.description ? <p>{p.data.description}</p> : null}
        </article>
      ))
    )}
  </section>

</Layout>
