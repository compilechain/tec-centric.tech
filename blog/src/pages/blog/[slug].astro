---
import { getCollection } from "astro:content";
import BlogLayout from "../../layouts/BlogLayout.astro";

/** Tell Astro which blog slugs to pre-render */
export async function getStaticPaths() {
  const posts = await getCollection("posts", ({ data }) => !data.draft);
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post }, // pass the entry to the page
  }));
}

const { post } = Astro.props;
const { Content, data } = await post.render();

const title = data.title ?? "Post";
const desc = data.description ?? "";
const canonical = new URL(Astro.url, Astro.site);
---
<BlogLayout {title} description={desc} {canonical}>
  <article>
    <h1 style="margin-top:0">{title}</h1>
    <div class="muted" style="font-size:14px;margin-bottom:16px">
      {new Date(data.date).toLocaleDateString()} · {data.readingTime ?? "5 min read"} · {data.tags?.join(", ")}
    </div>
    <Content />
    <!-- Giscus placeholder (will enable later) -->
  </article>
</BlogLayout>
